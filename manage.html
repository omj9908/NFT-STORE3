<!DOCTYPE html>
<html lang="en">
<head> 
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT ê´€ë¦¬</title>

    <style>
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header {
            width: 100%;
            height: 80px;
        }

        header > div {
            text-align: center;
            padding-top: 20px;
            font-family: 'Merienda', cursive;
            font-size: 40px;
            font-weight: bold;
            color: black;
        }

        /* í‘¸í„° ìŠ¤íƒ€ì¼ */
        footer {   
            width: 100%;
            height: 100px;
            border-top: 2px double black;
        }

        footer > div {
            text-align: center;
            font-family: 'Times New Roman';
            font-size: 12px;
            padding: 15px;
        }

        .card-img-top {
        width: 100%;  /* ì¹´ë“œ ë„ˆë¹„ì— ë§ì¶¤ */
        height: 250px; /* ê³ ì •ëœ ë†’ì´ */
        object-fit: cover; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ë°•ìŠ¤ë¥¼ ì±„ì›€ */
        border-radius: 10px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
    }

    </style>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Web3.js -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>

<header class="bg-info">
    <div>NFT ê´€ë¦¬</div>
</header>

<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” ì¶”ê°€ -->
<nav class="navbar navbar-expand-md bg-info">
    <div class="container my-0">
        <a class="navbar-brand" href="#">NFT</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#myMenuTop">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="myMenuTop">
            <ul class="navbar-nav me-auto mb-0">
                <li class="nav-item">
                    <a class="nav-link" href="listing.html">íŒë§¤ì¤‘</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="minting.html">ë¯¼íŒ…</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="manage.html">ê´€ë¦¬</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main class="container my-5">
    <h2 class="mt-4">ë‚´ ìì‚° ê´€ë¦¬</h2>
    <button id="loadSkinsBtn" class="btn btn-primary mb-3">ğŸ² ë‚´ ì¼ë°˜ì ì¸ ìŠ¤í‚¨(ERC-20) ë³´ê¸°</button>
    <button id="loadNFTsBtn" class="btn btn-success mb-3">ğŸŒŸ ë‚´ íŠ¹ë³„í•œ ìŠ¤í‚¨(NFT) ë³´ê¸°</button>

    <p id="status"></p>

    <!-- âœ… ë‚´ ERC-20 ìŠ¤í‚¨(ì£¼ì‚¬ìœ„) ë³´ìœ ëŸ‰ -->
    <h3>ğŸ² ë‚´ ì¼ë°˜ì ì¸ ìŠ¤í‚¨(ERC-20) ë³´ìœ ëŸ‰</h3>
    <div class="row">
        <!-- ğŸ”´ Red Dice ë³´ìœ ëŸ‰ -->
        <div class="col-md-6 text-center">
            <img src="./images/red-dice.png" alt="Red Dice" class="img-fluid" style="max-width: 100px;">
            <p id="redDiceBalance">ğŸ”´ Red Dice ë³´ìœ ëŸ‰: 0</p>
        </div>
        <!-- ğŸ”µ Blue Dice ë³´ìœ ëŸ‰ -->
        <div class="col-md-6 text-center">
            <img src="./images/blue-dice.png" alt="Blue Dice" class="img-fluid" style="max-width: 100px;">
            <p id="blueDiceBalance">ğŸ”µ Blue Dice ë³´ìœ ëŸ‰: 0</p>
        </div>
    </div>

    <!-- âœ… NFT ë° ìŠ¤í‚¨ ëª©ë¡ì„ í‘œì‹œí•  ì»¨í…Œì´ë„ˆ -->
    <h3>ğŸ“œ ë‚´ NFT ëª©ë¡</h3>
    <div class="row" id="nftContainer"></div>

    <h3>ğŸ² ë‚´ ì¼ë°˜ì ì¸ ìŠ¤í‚¨ ëª©ë¡</h3>
    <div class="row" id="skinContainer"></div>
</main>

<!-- âœ… ê´€ë¦¬ììš© ì¶œê¸ˆ ê¸°ëŠ¥ -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const withdrawButton = document.getElementById("withdrawButton");

    if (withdrawButton) {
        withdrawButton.addEventListener("click", async function () {
            await connectWallet();
            const accounts = await web3.eth.getAccounts();
            
            try {
                await contract.methods.withdrawFunds().send({ from: accounts[0] });

                alert("âœ… ì»¨íŠ¸ë™íŠ¸ ë‚´ ìˆ˜ìµì´ ì¶œê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤.");
            } catch (error) {
                console.error("âŒ ì¶œê¸ˆ ì˜¤ë¥˜:", error);
                alert("ì¶œê¸ˆ ì‹¤íŒ¨! ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            }
        });
    }
});
</script>

<div class="modal fade" id="nftInfoModal" tabindex="-1" aria-labelledby="nftInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">NFT ì„¸ë¶€ ì •ë³´</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <img id="nftImage" src="" class="img-fluid img-thumbnail" alt="NFT ì´ë¯¸ì§€" style="max-width: 100%; max-height: 300px; object-fit: contain;">
                </div>
                <p class="mt-3"><b>ID:</b> <span id="nftId"></span></p>
                <p><b>ì´ë¦„:</b> <span id="nftName"></span></p>
                <p><b>ê°€ê²©:</b> <span id="nftPrice"></span></p>
                <p><b>ì†Œìœ ì:</b> <span id="nftOwner"></span></p>
                <p><b>ì„¤ëª…:</b> <span id="nftDescription">ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.</span></p> 
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<!-- âœ… NFT ê°€ê²© ë³€ê²½ ëª¨ë‹¬ ì¶”ê°€ -->
<div class="modal fade" id="myModalChangePrice" tabindex="-1" aria-labelledby="myModalChangePriceLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">NFT ê°€ê²© ë³€ê²½</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="myID"> <!-- âœ… ìˆ¨ê²¨ì§„ í•„ë“œ (NFT ID ì €ì¥) -->
                <p><b>í˜„ì¬ ê°€ê²©:</b> <input type="text" id="oldPrice" class="form-control" disabled></p>
                <p><b>ìƒˆë¡œìš´ ê°€ê²© (ETH):</b> <input type="number" id="newPrice" class="form-control" placeholder="ìƒˆë¡œìš´ ê°€ê²© ì…ë ¥"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button type="button" class="btn btn-primary" onclick="confirmPriceChange()">ê°€ê²© ë³€ê²½</button>
            </div>
        </div>
    </div>
</div>

<!-- NFT ì´ë¦„ ë³€ê²½ ëª¨ë‹¬ -->
<div class="modal fade" id="nameChangeModal" tabindex="-1" aria-labelledby="nameChangeModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">NFT ì´ë¦„ ë³€ê²½</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="modalTokenId"> <!-- âœ… ìˆ¨ê²¨ì§„ í•„ë“œ (NFT ID ì €ì¥) -->
                <p><b>ìƒˆë¡œìš´ NFT ì´ë¦„:</b></p>
                <input type="text" id="newNFTName" class="form-control" placeholder="ìƒˆ ì´ë¦„ ì…ë ¥" 
                    style="display: block; visibility: visible;">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button type="button" class="btn btn-primary" onclick="changeNFTName()">ì´ë¦„ ë³€ê²½</button>
            </div>
        </div>
    </div>
</div>

<!-- âœ… ê´€ë¦¬ììš© ì¶œê¸ˆ ë²„íŠ¼ ì¶”ê°€ -->
<div class="container text-center my-4">
    <button id="withdrawButton" class="btn btn-danger">ì»¨íŠ¸ë™íŠ¸ ìˆ˜ìµ ì¶œê¸ˆ</button>
</div>

<!-- âœ… ê´€ë¦¬ììš© ì¶œê¸ˆ ê¸°ëŠ¥ -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const withdrawButton = document.getElementById("withdrawButton");

    if (withdrawButton) {
        withdrawButton.addEventListener("click", async function () {
            await connectWallet();
            const accounts = await web3.eth.getAccounts();
            
            try {
                // âœ… ì»¨íŠ¸ë™íŠ¸ì—ì„œ ETH ì¶œê¸ˆ (ëª¨ë“  ì‚¬ìš©ìê°€ ê°€ëŠ¥)
                await contract.methods.withdrawFunds().send({ 
                    from: accounts[0], 
                    gasLimit: 200000 
                });

                alert("âœ… ì»¨íŠ¸ë™íŠ¸ ë‚´ ìˆ˜ìµì´ ì¶œê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤.");
            } catch (error) {
                console.error("âŒ ì¶œê¸ˆ ì˜¤ë¥˜:", error);
                alert("ì¶œê¸ˆ ì‹¤íŒ¨! ì»¨íŠ¸ë™íŠ¸ì— ì”ì•¡ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
            }
        });
    }
});
</script>

</body>
</html>

<footer class="footer" style="margin-top: 30px">
    <div>ëª»ìƒê¸´ ê³ ë¦´ë¼ ì²˜ëŸ¼ ğŸ’™</div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Web3.js -->
<script src="./js/manage.js"></script>

</body>
</html>
